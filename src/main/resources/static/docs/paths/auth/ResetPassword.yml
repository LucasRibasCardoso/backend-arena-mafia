post:
  operationId: resetPassword
  tags: [ 'Autenticação - Recuperação de Senha' ]
  summary: Redefine a senha do usuário utilizando o token de redefinição.
  description: |
    Redefine a senha do usuário utilizando o `passwordResetToken` obtido na etapa anterior.
    A nova senha deve ser fornecida juntamente com a confirmação da senha, que deve ser idêntica.
    Após a redefinição, o token não pode ser reutilizado e o usuário precisa fazer login novamente.
  requestBody:
    description: Corpo da requisição contendo o token de redefinição e a nova senha.
    required: true
    content:
      application/json:
        schema:
          $ref: '../../components/schemas/password/ResetPasswordRequestDto.yml'
  responses:
    204:
      description: Senha redefinida com sucesso. Não há conteúdo na resposta.
      headers:
        Set-Cookie:
          description: |
            Define um cookie `refreshToken` com tempo de vida expirado (`Max-Age=0`), 
            instruindo o navegador a removê-lo imediatamente. Os atributos de segurança 
            (HttpOnly, Secure, SameSite) são mantidos para consistência.
          schema:
            type: string
            example: "refreshToken=; Max-Age=0; Path=/; Secure; HttpOnly; SameSite=Strict"
    400:
      description: Erro lançado quando os dados de entrada forem inválidos.
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/error/ErrorResponseDto.yml'
          examples:
            ResetTokenIncorrectOrExpired:
              summary: Token de redefinição incorreto ou expirado
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "RESET_TOKEN_INCORRECT_OR_EXPIRED"
                developerMessage: "Token de redefinição de senha incorreto ou expirado."
                path: "/api/auth/reset-password"
            InvalidFormatPasswordResetToken:
              summary: PasswordResetToken com formato Inválido
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "VALIDATION_FAILED"
                developerMessage: "A validação falhou. Verifique os detalhes dos campos para mais informações."
                path: "/api/auth/reset-password"
                fieldErrors:
                  - fieldName: "passwordResetToken"
                    errorCode: "RESET_TOKEN_REQUIRED"
                    developerMessage: "O token de redefinição de senha é obrigatório."
                  - fieldName: "passwordResetToken"
                    errorCode: "RESET_TOKEN_INVALID_FORMAT"
                    developerMessage: "O formato do token de redefinição de senha é inválido."
            InvalidFormatNewPassword:
              summary: Nova senha com formato Inválido
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "VALIDATION_FAILED"
                developerMessage: "A validação falhou. Verifique os detalhes dos campos para mais informações."
                path: "/api/auth/reset-password"
                fieldErrors:
                  - fieldName: "newPassword"
                    errorCode: "PASSWORD_REQUIRED"
                    developerMessage: "A senha é obrigatória."
                  - fieldName: "newPassword"
                    errorCode: "PASSWORD_INVALID_LENGTH"
                    developerMessage: "A senha deve ter entre 6 e 20 caracteres."
                  - fieldName: "newPassword"
                    errorCode: "PASSWORD_NO_WHITESPACE"
                    developerMessage: "A senha não pode conter espaços em branco."
            InvalidFormatConfirmPassword:
              summary: Confirmação de senha com formato Inválido
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "VALIDATION_FAILED"
                developerMessage: "A validação falhou. Verifique os detalhes dos campos para mais informações."
                path: "/api/auth/reset-password"
                fieldErrors:
                  - fieldName: "confirmPassword"
                    errorCode: "CONFIRM_PASSWORD_REQUIRED"
                    developerMessage: "A confirmação de senha é obrigatória."
                  - fieldName: "confirmPassword"
                    errorCode: "PASSWORD_INVALID_LENGTH"
                    developerMessage: "A senha deve ter entre 6 e 20 caracteres."
                  - fieldName: "confirmPassword"
                    errorCode: "PASSWORD_NO_WHITESPACE"
                    developerMessage: "A senha não pode conter espaços em branco."
                  - fieldName: "confirmPassword"
                    errorCode: "PASSWORDS_DO_NOT_MATCH"
                    developerMessage: "A senha de confirmação não corresponde à senha."
    403:
      $ref: '../../components/responses/AccountStatusForbidden.yml'
    404:
      description: |
        Error lançado quando não foi encontrado um usuário associado ao passwordResetToken. Pode 
        ocorrer se o usuário for deletado após iniciar o processo de redefinição de senha
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/error/ErrorResponseDto.yml'
          examples:
            UserNotFound:
              summary: Usuário não encontrado
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 404
                errorCode: "USER_NOT_FOUND"
                developerMessage: "Usuário não encontrado."
                path: "/api/auth/reset-password"
    500:
      $ref: '../../components/responses/InternalServerError.yml'