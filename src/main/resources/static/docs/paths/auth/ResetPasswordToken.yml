post:
  operationId: resetPasswordToken
  tags: [ 'Autenticação - Recuperação de Senha' ]
  summary: Valida o código OTP e retorna um token de redefinição de senha.
  description: |
    Valida o código OTP (One-Time Password) enviado ao usuário. Se o código for válido e 
    corresponder ao `otpSessionId`, retorna um `passwordResetToken` que deve ser usado para 
    alterar a senha na próxima etapa. O código OTP é válido por 10 minutos.
  requestBody:
    description: Corpo da requisição contendo o `otpSessionId` e o código OTP.
    required: true
    content:
      application/json:
        schema:
          $ref: '../../components/schemas/auth/ValidateOtpRequestDto.yml'
  responses:
    200:
      description: |
        Código OTP validado com sucesso. Retorna o token de redefinição de senha. Esse token será
        utilizado na próxima etapa para alterar a senha do usuário.
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/password/PasswordResetTokenResponseDto.yml'
    400:
      description: Erro lançado quando os dados de entrada forem inválidos.
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/error/ErrorResponseDto.yml'
          examples:
            InvalidFormatOtpSessionId:
              summary: OtpSessionId com formato Inválido
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "VALIDATION_FAILED"
                developerMessage: "A validação falhou. Verifique os detalhes dos campos para mais informações."
                path: "/api/auth/reset-password-token"
                fieldErrors:
                  - fieldName: "otpSessionId"
                    errorCode: "OTP_SESSION_ID_REQUIRED"
                    developerMessage: "O ID da sessão OTP é obrigatório."
                  - fieldName: "otpSessionId"
                    errorCode: "OTP_SESSION_ID_INVALID_FORMAT"
                    developerMessage: "O formato do ID da sessão OTP é inválido."
            InvalidFormatOtpCode:
              summary: Código OTP com formato Inválido
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "VALIDATION_FAILED"
                developerMessage: "A validação falhou. Verifique os detalhes dos campos para mais informações."
                path: "/api/auth/reset-password-token"
                fieldErrors:
                  - fieldName: "otpCode"
                    errorCode: "OTP_CODE_REQUIRED"
                    developerMessage: "O código de verificação é obrigatório."
                  - fieldName: "otpCode"
                    errorCode: "OTP_CODE_INVALID_FORMAT"
                    developerMessage: "O código de verificação deve ser composto por 6 dígitos numéricos."
            InvalidOrExpiredOtpSessionId:
              summary: OtpSessionId Inválido ou Expirado
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "OTP_SESSION_INVALID_OR_EXPIRED"
                developerMessage: "Sessão para a validação do código OTP expirada ou inválida."
                path: "/api/auth/reset-password-token"
            InvalidOrExpiredOtpCode:
              summary: Código OTP Inválido ou Expirado
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "OTP_CODE_INVALID_OR_EXPIRED"
                developerMessage: "Código de verificação inválido ou expirado."
                path: "/api/auth/reset-password-token"
    403:
      $ref: '../../components/responses/AccountStatusForbidden.yml'
    404:
      description: |
        Error lançado quando não foi encontrado um usuário associado ao otpSessionId. Pode 
        ocorrer se o usuário tiver sido deletado após iniciar o processo de redefinição de senha
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/error/ErrorResponseDto.yml'
          example:
            timestamp: "2024-06-15T14:30:00Z"
            status: 404
            errorCode: "USER_NOT_FOUND"
            developerMessage: "Usuário não encontrado."
            path: "/api/auth/reset-password-token"
    500:
      $ref: '../../components/responses/InternalServerError.yml'