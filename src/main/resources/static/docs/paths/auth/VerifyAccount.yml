post:
  operationId: verifyAccount
  tags: [ 'Autenticação - Cadastro de Usuário' ]
  summary: Validar o código OTP para verificação e ativação da conta.
  description: |
    Este endpoint valida o código OTP enviado ao telefone do usuário durante o processo de cadastro. 
    Se o código for válido, a conta do usuário será ativada. Também retorna um token JWT (JSON Web Token)
    que deve ser usado para autorizar requisições subsequentes aos endpoints protegidos.
    Além disso, um `refreshToken` é enviado como um cookie seguro para renovação da sessão.
  requestBody:
    description: |
      Corpo da requisição contendo o OtpSessionId que foi retornado no cadastro do usuário e 
      o código OTP preenchido pelo usuário.
    required: true
    content:
      application/json:
        schema:
          $ref: '../../components/schemas/auth/ValidateOtpRequestDto.yml'
  responses:
    200:
      description: Conta ativada com sucesso e usuário autenticado. Retorna o token JWT e o cookie de refreshToken.
      headers:
        Set-Cookie:
          $ref: '../../components/headers/SetCookie.yml'
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/auth/AuthResponseDto.yml'
    400:
      description: Erro lançado quando os dados de entrada forem inválidos.
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/error/ErrorResponseDto.yml'
          examples:
            InvalidFormatOtpSessionId:
              summary: OtpSessionId com formato Inválido
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "VALIDATION_FAILED"
                developerMessage: "A validação falhou. Verifique os detalhes dos campos para mais informações."
                path: "/api/auth/verify-account"
                fieldErrors:
                  - fieldName: "otpSessionId"
                    errorCode: "OTP_SESSION_ID_REQUIRED"
                    developerMessage: "O ID da sessão OTP é obrigatório."
                  - fieldName: "otpSessionId"
                    errorCode: "OTP_SESSION_ID_INVALID_FORMAT"
                    developerMessage: "O formato do ID da sessão OTP é inválido."
            InvalidFormatOtpCode:
              summary: Código OTP com formato Inválido
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "VALIDATION_FAILED"
                developerMessage: "A validação falhou. Verifique os detalhes dos campos para mais informações."
                path: "/api/auth/verify-account"
                fieldErrors:
                  - fieldName: "otpCode"
                    errorCode: "OTP_CODE_REQUIRED"
                    developerMessage: "O código de verificação é obrigatório."
                  - fieldName: "otpCode"
                    errorCode: "OTP_CODE_INVALID_FORMAT"
                    developerMessage: "O código de verificação deve ser composto por 6 dígitos numéricos."
            InvalidOrExpiredOtpSessionId:
              summary: OtpSessionId Inválido ou Expirado
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "OTP_SESSION_INVALID_OR_EXPIRED"
                developerMessage: "Sessão para a validação do código OTP expirada ou inválida."
                path: "/api/auth/verify-account"
            InvalidOrExpiredOtpCode:
              summary: Código OTP Inválido ou Expirado
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "OTP_CODE_INVALID_OR_EXPIRED"
                developerMessage: "Código de verificação inválido ou expirado."
                path: "/api/auth/verify-account"
    403:
      description: Erro lançado quando o status da conta do usuário não está como pendente de verificação.
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/error/ErrorResponseDto.yml'
          examples:
            AccountNotPendingVerification:
              summary: Conta não está pendente de verificação
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 403
                errorCode: "ACCOUNT_NOT_PENDING_VERIFICATION"
                developerMessage: "Esta operação só pode ser executada em contas com verificação pendente."
                path: "/api/auth/verify-account"
    404:
      description: Erro lançado quando o usuário associado ao OtpSessionId não for encontrado.
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/error/ErrorResponseDto.yml'
          examples:
            UserNotFound:
              summary: Usuário não encontrado
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 404
                errorCode: "USER_NOT_FOUND"
                developerMessage: "Usuário não encontrado."
                path: "/api/auth/verify-account"
    500:
      $ref: '../../components/responses/InternalServerError.yml'