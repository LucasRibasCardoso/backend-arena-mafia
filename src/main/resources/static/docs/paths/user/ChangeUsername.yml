patch:
  operationId: changeUsername
  summary: Alterar o nome de usuário do usuário
  tags: [ 'Usuário - Minha Conta - Segurança' ]
  description: |
    Altera o nome de usuário do usuário. O novo nome de usuário deve ser único
    e atender aos critérios de validação definidos.
  requestBody:
    description: Corpo da requisição contendo o novo nome de usuário.
    required: true
    content:
      application/json:
        schema:
          $ref: '../../components/schemas/user/ChangeUsernameRequestDto.yml'
  security:
    - BearerAuth: [ ]
  responses:
    200:
      description: Perfil do usuário atualizado com sucesso, retornando os dados atualizados do usuário.
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/user/UserProfileResponseDto.yml'
    400:
      description: Erro lançado quando os dados de entrada forem inválidos.
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/error/ErrorResponseDto.yml'
          examples:
            InvalidFormatUsername:
              summary: Novo nome de usuário com formato inválido
              value:
                timestamp: "2024-06-15T14:30:00Z"
                status: 400
                errorCode: "VALIDATION_FAILED"
                developerMessage: "A validação falhou. Verifique os detalhes dos campos para mais informações."
                path: "/api/users/me/username"
                fieldErrors:
                  - fieldName: "username"
                    errorCode: "USERNAME_REQUIRED"
                    developerMessage: "O nome de usuário é obrigatório."
                  - fieldName: "username"
                    errorCode: "USERNAME_INVALID_FORMAT"
                    developerMessage: "O nome de usuário pode conter apenas letras, números e underscore (_)."
                  - fieldName: "username"
                    errorCode: "USERNAME_INVALID_LENGTH"
                    developerMessage: "O nome de usuário deve ter entre 3 e 50 caracteres."
    401:
      description: Erro lançado quando o usuário não estiver autenticado.
      $ref: '../../components/responses/UnauthorizedError.yml'
    409:
      description: Erro lançado quando o novo nome de usuário já estiver em uso por outro usuário.
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/error/ErrorResponseDto.yml'
          examples:
            UsernameAlreadyInUse:
              summary: Novo nome de usuário já está em uso
              value:
                status: 409
                errorCode: "USERNAME_ALREADY_EXISTS"
                developerMessage: "Esse nome de usuário já está em uso."
                path: "/api/users/me/username"
    500:
      $ref: '../../components/responses/InternalServerError.yml'